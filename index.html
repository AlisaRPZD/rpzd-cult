<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>RPZD Cult</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
       @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@900&display=swap');
       /* --- –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –ö–ò–°–õ–û–¢–ù–û–ì–û –°–¢–ò–õ–Ø --- */
        :root {
            --primary-color: #00FF00; /* –Ø—Ä–∫–∏–π –Ω–µ–æ–Ω–æ–≤—ã–π –∑–µ–ª–µ–Ω—ã–π */
            --secondary-color: #00FFFF; /* –ö–∏—Å–ª–æ—Ç–Ω—ã–π –≥–æ–ª—É–±–æ–π */
            --highlight-color: #FF00FF; /* –ú–∞–ª–∏–Ω–æ–≤—ã–π */
            --text-color: #E0E0E0; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
            --bg-color: #1a1a1a; /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω */
            --panel-bg: rgba(25, 25, 25, 0.9); /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π –¥–ª—è –ø–∞–Ω–µ–ª–µ–π */
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow: 0 4px 15px rgba(0,0,0,0.5);
            --light-glow: 0 0 5px var(--secondary-color), 0 0 10px var(--secondary-color), 0 0 15px var(--secondary-color);
        }

        html { font-size: 14px; }

        body {
            margin: 0;
            font-family: 'Fira Code', monospace; /* –ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç */
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            overflow-x: hidden; /* –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∞ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
            position: relative;
        }
        
        /* –°–µ—Ç–∫–∞-—Ñ–æ–Ω */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(to right, #2c2c2c 1px, transparent 1px), linear-gradient(to bottom, #2c2c2c 1px, transparent 1px);
            background-size: 25px 25px;
            z-index: -1;
            opacity: 0.1;
        }

        .app, .missions-screen, .safe-screen, .admin-panel-screen, .gang-screen, .vip-screen, .info-screen {
            backdrop-filter: blur(5px);
            background: var(--panel-bg);
            /* –û–ë–ù–û–í–õ–ï–ù–û: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —à–∏—Ä–∏–Ω–æ–π –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤—ã–ª–µ–∑–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
            max-width: 95vw; /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞, —á—Ç–æ–±—ã –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç—å –∑–∞ –∫—Ä–∞—è —ç–∫—Ä–∞–Ω–∞ */
            width: 400px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Å –ø–æ–º–æ—â—å—é margin: auto; */
            margin: 20px auto; 
            padding: 4vw; /* –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π padding –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
            border-radius: 1.5vw;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden; /* –°–∫—Ä—ã–≤–∞–µ—Ç –≤—ã–ª–µ–∑–∞—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
            flex-direction: column;
            align-items: center;
            transition: all 0.5s ease;
            transform-style: preserve-3d;
            perspective: 1000px;
            box-sizing: border-box; /* –£—á–∏—Ç—ã–≤–∞–µ—Ç padding –∏ border –≤ —à–∏—Ä–∏–Ω–µ */
        }

        .app:hover {
            transform: translateY(-5px) rotateX(1deg) rotateY(-1deg);
        }

        .screen-content {
            width: 100%;
            transform: translateZ(20px);
        }

        header h1 {
            text-align: center;
            font-family: 'Fira Code', monospace;
            font-size: 8vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: var(--primary-color);
            margin: 0;
            text-shadow: 0 0 10px var(--primary-color), 0 0 20px rgba(0, 255, 0, 0.4);
            transform: translateZ(5px);
            transition: all 0.3s;
        }

        header p {
            text-align: center;
            color: var(--secondary-color);
            font-size: 3vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            margin: 1vw 0;
            transform: translateZ(5px);
        }

        .balance-box {
            text-align: center;
            margin: 4vw 0;
            padding: 2vw;
            border: 1px solid var(--border-color);
            border-radius: 1.5vw;
            background: rgba(255, 255, 255, 0.05);
            box-shadow: var(--shadow);
            transform: translateZ(10px);
        }

        .balance-box p:first-child {
            font-family: 'Fira Code', monospace;
            font-size: 8vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            font-weight: bold;
            color: var(--primary-color);
            text-shadow: var(--light-glow);
            margin: 0.5vw 0;
        }

        #user-level {
            font-family: 'Fira Code', monospace;
            font-size: 4vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: var(--secondary-color);
            margin: 1vw 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .user-avatar {
            font-size: 4vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            margin-right: 1.5vw;
        }

        #wallet-info {
            display: inline-block;
            background: rgba(255, 255, 255, 0.05);
            color: var(--secondary-color);
            font-family: 'Fira Code', monospace;
            font-size: 3vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            padding: 2vw 3vw;
            border-radius: 1.5vw;
            margin-top: 2vw;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
            word-break: break-all;
            box-shadow: 0 0 5px var(--secondary-color);
            transform: translateZ(5px);
        }

        #wallet-info:hover {
            box-shadow: 0 0 15px var(--secondary-color);
            transform: scale(1.02) translateZ(10px);
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 3vw;
            width: 100%;
        }
        
        /* –ù–æ–≤—ã–π —Å—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞ —Ç–∞–π–º–µ—Ä–∞ */
        #claim-timer-text {
            text-align: center;
            font-family: 'Fira Code', monospace;
            color: var(--highlight-color);
            font-size: 4vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            margin-top: -2vw;
            margin-bottom: 2vw;
            transform: translateZ(5px);
        }

        /* CLAIM BUTTON STYLES */
        #claim-btn {
            width: 45vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–Ω–æ–ø–∫–∏ */
            height: 45vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–Ω–æ–ø–∫–∏ */
            border-radius: 50%;
            align-self: center;
            border: 0.5vw solid var(--primary-color);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.4), inset 0 0 20px rgba(0, 255, 0, 0.2);
            background: radial-gradient(circle, rgba(0, 255, 0, 0.3) 0%, rgba(0, 255, 255, 0.3) 100%);
            position: relative;
            overflow: hidden;
            padding: 0;
            cursor: pointer;
            transition: all 0.3s;
            transform: translateZ(10px);
            transform-style: preserve-3d;
        }
        
        #claim-btn:hover {
            box-shadow: 0 0 40px rgba(0, 255, 0, 0.8), inset 0 0 30px rgba(0, 255, 0, 0.4);
            transform: scale(1.05) translateZ(20px) rotateX(5deg);
        }

        /* RPZD —Ç–µ–∫—Å—Ç —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º —Å–≤–µ—á–µ–Ω–∏—è */
        #claim-btn::before {
            content: 'RPZD';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) translateZ(1px);
            font-size: 16vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: var(--primary-color);
            font-family: 'Fira Code', monospace;
            z-index: 0;
            text-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color);
            opacity: 0.5;
        }
        
        /* -- –í–î–ê–í–õ–ï–ù–ù–´–ô 3D-–≠–§–§–ï–ö–¢ -- */
        #rotating-69 {
          position: relative;
          z-index: 1;
          display: flex;
          align-items: center;
          justify-content: center;
          width: 100%;
          height: 100%;
          font-family: 'Nunito', sans-serif;
          font-size: 34vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
          color: var(--bg-color);
          font-weight: 900;
          -webkit-text-stroke: 0.7vw var(--text-color); /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ç–æ–ª—â–∏–Ω–∞ –æ–±–≤–æ–¥–∫–∏ */
          text-shadow: 
            -0.5vw -0.5vw 1vw rgba(255, 255, 255, 0.7), 
            0.5vw 0.5vw 1vw rgba(0, 0, 0, 0.2), 
            0 0 2vw rgba(0, 0, 0, 0.1);
          animation: slowRotate 10s linear infinite;
        }

        #claim-btn:hover #rotating-69 {
            text-shadow: 
            -0.7vw -0.7vw 1.5vw rgba(255, 255, 255, 0.9), 
            0.7vw 0.7vw 1.5vw rgba(0, 0, 0, 0.3), 
            0 0 3vw rgba(0, 0, 0, 0.2);
        }
        
        @keyframes slowRotate {
            from { transform: rotate(0deg) translateZ(2px); }
            to { transform: rotate(360deg) translateZ(2px); }
        }
        
        /* –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Å –∫–æ–Ω—Ç—É—Ä–æ–º */
        button:not(#claim-btn) {
            padding: 3vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π padding */
            background: var(--secondary-color);
            color: var(--bg-color);
            border: 0.3vw solid var(--primary-color); /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ç–æ–ª—â–∏–Ω–∞ –æ–±–≤–æ–¥–∫–∏ */
            border-radius: 1.5vw;
            font-size: 4vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
            transform: translateY(0) translateZ(5px);
        }

        button:not(#claim-btn):hover {
            box-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color);
            transform: translateY(-5px) scale(1.02) translateZ(10px);
        }

        button:not(#claim-btn):active {
            transform: translateY(0) translateZ(5px);
        }
        
        .ad-banner {
            margin: 4vw 0;
            background: linear-gradient(90deg, var(--highlight-color), var(--secondary-color));
            color: var(--bg-color);
            padding: 3vw;
            text-align: center;
            border-radius: 1.5vw;
            font-size: 4vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            cursor: pointer;
            border: none;
            box-shadow: var(--shadow);
            text-shadow: none;
            transition: all 0.3s;
            transform: translateZ(5px);
        }
        
        .ad-banner:hover {
            transform: translateY(-5px) translateZ(10px);
        }

        footer {
            text-align: center;
            color: #777;
            font-size: 3vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            margin-top: 4vw;
            transform: translateZ(5px);
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –í–°–ï —ç–∫—Ä–∞–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        .app, .missions-screen, .safe-screen, .admin-panel-screen, .gang-screen, .vip-screen, .info-screen {
            display: none;
        }

        /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        .app {
            display: flex;
        }

        .mission-item, .admin-item, .gang-member-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 1.5vw;
            padding: 3vw;
            margin-bottom: 3vw;
            box-shadow: var(--shadow);
            transform: translateZ(5px);
        }
        
        .mission-title, .admin-title, .gang-title {
            font-family: 'Fira Code', monospace;
            font-weight: bold;
            color: var(--primary-color);
            font-size: 4vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            margin-bottom: 2vw;
            text-shadow: var(--light-glow);
        }

        .mission-reward {
            color: var(--highlight-color);
            font-size: 3.5vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            text-shadow: 0 0 5px var(--highlight-color);
        }
        
        .mission-progress {
            height: 2vw;
            background: #222;
            border-radius: 1vw;
            margin: 2vw 0;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.4);
        }
        
        .mission-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            width: 0%;
            transition: width 0.3s;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
        }
        
        .mission-button {
            width: 100%;
        }
        
        .mission-button.completed {
            background: var(--primary-color) !important;
            color: var(--bg-color) !important;
        }

        .mission-link {
            color: var(--secondary-color);
            text-decoration: none;
            font-size: 3.5vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            display: block;
            margin: 2vw 0;
            word-break: break-all;
        }

        .wc-button {
            background: var(--primary-color) !important;
            color: var(--bg-color) !important;
            text-shadow: none !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(0, 255, 0, 0.4) !important;
        }
        
        /* Safe Screen Styling */
        #safe-container {
            position: relative;
            width: 80vw;
            height: 80vw;
            max-width: 400px;
            max-height: 400px;
            margin: 4vw auto;
            transform: translateZ(10px);
            border: 1px solid #777; /* –°–µ—Ä—ã–π —Ü–≤–µ—Ç –¥–ª—è —Å–µ–π—Ñ–∞ */
            border-radius: 1.5vw;
            box-shadow: 0 0 15px rgba(0,0,0,0.7), inset 0 0 10px rgba(255,255,255,0.1);
            overflow: hidden;
            background: linear-gradient(to bottom, #444, #222); /* –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –æ–±—ä–µ–º–Ω–æ—Å—Ç–∏ */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #safe-dial {
            font-family: 'Fira Code', monospace;
            font-size: 15vw; /* –ë–æ–ª—å—à–∏–µ —Ü–∏—Ñ—Ä—ã */
            color: var(--primary-color);
            text-shadow: 0 0 10px var(--primary-color);
            display: inline-block;
            white-space: pre; /* –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–±–µ–ª—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
        }
        
        #safe-result-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Fira Code', monospace;
            font-size: 6vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: var(--primary-color);
            text-align: center;
            text-shadow: 0 0 10px var(--primary-color);
            z-index: 2;
            padding: 1vw; /* –î–æ–±–∞–≤–∏–ª padding */
            background: rgba(0,0,0,0.7); /* –§–æ–Ω –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ */
            border-radius: 1vw;
        }

        #safe-info {
            font-family: 'Fira Code', monospace;
            font-size: 4vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            margin: 4vw 0;
            text-align: center;
            color: var(--secondary-color);
        }
        
        #safe-feed {
            width: 100%;
            margin-top: 4vw;
            background: rgba(255, 255, 255, 0.05);
            padding: 3vw;
            border-radius: 1.5vw;
            max-height: 25vh;
            overflow-y: auto;
            transform: translateZ(5px);
        }
        
        #safe-feed h3 {
            font-family: 'Fira Code', monospace;
            font-size: 4.5vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: var(--secondary-color);
            margin-top: 0;
            text-shadow: var(--light-glow);
        }
        
        #safe-feed ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column-reverse;
            gap: 2vw;
        }
        
        #safe-feed li {
            font-size: 3.5vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            background: rgba(255, 255, 255, 0.03);
            padding: 2vw;
            border-radius: 1vw;
            border-left: 0.5vw solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            word-break: break-all;
            font-family: 'Fira Code', monospace;
        }
        
        .win-text {
            color: var(--highlight-color);
            font-weight: bold;
        }
        .fail-text {
            color: #F44336; /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –ø—Ä–æ–∏–≥—Ä—ã—à–∞ */
            font-weight: bold;
        }

        /* Admin Panel Styling */
        #admin-panel-screen .admin-controls {
            display: flex;
            flex-direction: column;
            gap: 3vw;
        }
        
        .admin-controls .panel-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 1.5vw;
            padding: 3vw;
            box-shadow: var(--shadow);
            transform: translateZ(5px);
        }
        
        .admin-controls .panel-section h3 {
            font-family: 'Fira Code', monospace;
            font-size: 5vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: var(--highlight-color);
            margin-top: 0;
            text-shadow: 0 0 5px var(--highlight-color);
        }
        
        .admin-controls label {
            display: block;
            margin-bottom: 1vw;
            font-size: 3.5vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: var(--secondary-color);
        }
        
        .admin-controls input, .admin-controls select {
            width: 100%;
            padding: 2vw;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 1vw;
            color: var(--text-color);
            font-size: 3.5vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            margin-bottom: 2vw;
            transition: all 0.3s;
            transform: translateZ(2px);
            box-sizing: border-box; /* –£—á–∏—Ç—ã–≤–∞–µ—Ç padding –∏ border –≤ —à–∏—Ä–∏–Ω–µ */
        }

        .admin-controls input:focus, .admin-controls select:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            border-color: var(--secondary-color);
            transform: scale(1.01) translateZ(4px);
        }
        
        .admin-controls button {
            width: 100%;
            padding: 3vw;
            font-size: 4vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            box-sizing: border-box; /* –£—á–∏—Ç—ã–≤–∞–µ—Ç padding –∏ border –≤ —à–∏—Ä–∏–Ω–µ */
        }

        #user-balances-list {
            list-style: none;
            padding: 0;
        }
        
        #user-balances-list li {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2vw;
            border-radius: 1vw;
            margin-bottom: 1.5vw;
            word-break: break-all;
            font-family: 'Fira Code', monospace;
            font-size: 3vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
        }

        #admin-mission-list {
            list-style: none;
            padding: 0;
        }

        #admin-mission-list li {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2vw;
            border-radius: 1vw;
            margin-bottom: 1.5vw;
            font-size: 3.5vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
        }

        #admin-mission-list button {
            margin-top: 1.5vw;
            font-size: 3.5vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            padding: 2vw;
        }
        
        .info-screen h2 {
            font-family: 'Fira Code', monospace;
            font-size: 5vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: var(--highlight-color);
            margin-top: 5vw;
            text-shadow: 0 0 5px var(--highlight-color);
        }

        .info-screen h3 {
            font-family: 'Fira Code', monospace;
            font-size: 4.5vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: var(--secondary-color);
            margin-top: 4vw;
        }
        
        .info-screen ul {
            list-style-type: 'üëâ ';
            padding-left: 5vw;
        }
        
        .info-screen li {
            margin-bottom: 2vw;
            font-size: 3.5vw; /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
        }

        /* –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ */
        #ref-link-container {
            display: flex;
            align-items: center;
            gap: 2vw;
            margin-top: 3vw;
        }

        #ref-link-input {
            flex-grow: 1;
            padding: 2.5vw;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 1.5vw;
            color: var(--text-color);
            font-size: 3.5vw;
            word-break: break-all;
            box-sizing: border-box;
        }

        #copy-ref-link-btn {
            padding: 2.5vw 4vw;
            font-size: 3.5vw;
            white-space: nowrap;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞ */
        .share-modal {
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
        }

        .share-modal-content {
            background: var(--panel-bg);
            margin: auto;
            padding: 5vw;
            border: 1px solid var(--border-color);
            border-radius: 1.5vw;
            width: 80%;
            max-width: 350px;
            box-shadow: var(--shadow);
            text-align: center;
            transform: translateZ(20px);
            position: relative;
        }

        .share-modal-content h3 {
            color: var(--primary-color);
            font-size: 5vw;
            margin-top: 0;
            margin-bottom: 4vw;
        }

        .share-modal-content p {
            font-size: 3.5vw;
            color: var(--text-color);
            margin-bottom: 4vw;
            word-break: break-all;
        }

        .share-modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 3vw;
        }

        .share-modal-buttons a {
            display: block;
            padding: 3vw;
            border-radius: 1.5vw;
            text-decoration: none;
            color: var(--bg-color);
            font-size: 4vw;
            transition: all 0.3s;
        }

        .share-modal-buttons a.telegram { background-color: #2AABEE; }
        .share-modal-buttons a.whatsapp { background-color: #25D366; }
        .share-modal-buttons a.vkontakte { background-color: #4C75A3; }
        .share-modal-buttons a.facebook { background-color: #1877F2; }

        .share-modal-buttons a:hover {
            opacity: 0.8;
            transform: scale(1.02);
        }

        .close-button {
            position: absolute;
            top: 2vw;
            right: 3vw;
            color: var(--text-color);
            font-size: 5vw;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover {
            color: var(--highlight-color);
        }


        @media (min-width: 600px) {
            html { font-size: 16px; }
            .app, .missions-screen, .safe-screen, .admin-panel-screen, .gang-screen, .vip-screen, .info-screen {
                max-width: 500px;
                width: 500px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ */
                padding: 24px;
            }
            .app:hover {
                transform: translateY(-5px) rotateX(1deg) rotateY(-1deg) translateZ(5px);
            }
            #safe-container {
                width: 350px;
                height: 350px;
            }
            header h1 { font-size: 48px; }
            header p { font-size: 16px; }
            .balance-box p:first-child { font-size: 48px; }
            #user-level { font-size: 24px; }
            .user-avatar { font-size: 24px; margin-right: 8px; }
            #wallet-info, button:not(#claim-btn) { font-size: 16px; padding: 12px; }
            #claim-btn { width: 200px; height: 200px; }
            #claim-btn:hover {
                transform: scale(1.05) translateZ(20px) rotateX(5deg);
            }
            #claim-btn::before { font-size: 64px; }
            #rotating-69 { font-size: 120px; -webkit-text-stroke: 4px var(--text-color); }
            #claim-timer-text { font-size: 20px; }
            .mission-title, .mission-reward, .mission-link, .ad-banner, footer, .admin-controls input, .admin-controls label, .admin-controls button, #admin-mission-list li, #admin-mission-list button { font-size: 16px; }
            #safe-info { font-size: 18px; }
            #safe-result-display { font-size: 36px; }
            .admin-controls .panel-section h3 { font-size: 20px; }
            .info-screen h2 { font-size: 24px; }
            .info-screen h3 { font-size: 20px; }
            .info-screen li, .info-screen p { font-size: 16px; }
            #safe-feed h3 { font-size: 20px; }
            #safe-feed li { font-size: 16px; }

            /* –î–µ—Å–∫—Ç–æ–ø–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
            #ref-link-input { font-size: 16px; padding: 10px; }
            #copy-ref-link-btn { font-size: 16px; padding: 10px 15px; }
            .share-modal-content h3 { font-size: 24px; }
            .share-modal-content p { font-size: 16px; }
            .share-modal-buttons a { font-size: 16px; padding: 12px; }
            .close-button { font-size: 24px; top: 10px; right: 15px; }
        }
    </style>
</head>
<body>
    <div class="app" id="main-app">
        <div class="screen-content">
            <header>
                <h1>üß† RPZD Cult</h1>
                <p>–¢–æ–∫–µ–Ω –Ω–∞—Å—Ç–æ—è—â–∏—Ö —Ä–∞—Å–ø–∏–∑–¥—è–µ–≤</p>
            </header>
    
            <div class="balance-box">
                <p>üí∞ <span id="rpzd-balance">0</span> RPZD</p>
                <p id="user-level"><span class="user-avatar" id="user-avatar"></span><span id="user-level-text">–ù–∞—á–∏–Ω–∞—é—â–∏–π —Ä–∞—Å–ø–∏–∑–¥—è–π</span></p>
                <p id="wallet-info" title=""></p>
            </div>
            <div class="buttons">
                <div id="connect-wallet-btn"></div>
                <button id="claim-btn">
                    <span id="rotating-69">69</span>
                </button>
                <p id="claim-timer-text"></p>
                <button id="safe-cracking-btn">üîí –í–∑–ª–æ–º–∞—Ç—å –°–µ–π—Ñ!</button>
                <button id="gang-btn">üë• –ü–æ–¥–Ω—è—Ç—å –ë–∞–Ω–¥—É</button>
                <button id="mission-btn">üèÜ –ó–∞–¥–∞–Ω–∏—è –¥–ª—è –ü–∞—Ü–∞–Ω—á–∏–∫–æ–≤</button>
                <button id="vip-btn">‚≠ê VIP-–ü–æ–∫—É–ø–∫–∞</button>
                <button id="info-btn">‚ÑπÔ∏è –ß—ë –∫–∞–∫, –±—Ä–∞—Ç–∞–Ω?</button>
                <button id="admin-btn" style="display: none;">–ó–∞–¥–Ω–∏–π –í—Ö–æ–¥üö™</button>
            </div>
            <div class="ad-banner" id="idea-banner" style="display: none;"></div>
            <footer>
                <p class="quote" id="daily-quote">üí¨ –§–ª–µ–∫—Å ‚Äî —ç—Ç–æ –Ω–µ –≤—ã–±–æ—Ä, –∞ –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏.</p>
                <p>¬© 2025 –†–∞—Å–ø–∏–∑–¥—è–∏</p>
            </footer>
        </div>
    </div>

    <div class="missions-screen" id="missions-screen">
        <div class="screen-content">
            <header><h1>üß™ –ó–∞–¥–∞–Ω–∏—è –¥–ª—è –ß–°–í</h1></header>
            <div id="missions-container"></div>
            <div class="buttons">
                <button onclick="backToMain()">üîô –ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>
    
    <div class="safe-screen" id="safe-screen">
        <div class="screen-content">
            <header><h1>üîí –í–∑–ª–æ–º –°–µ–π—Ñ–∞</h1></header>
            <div id="safe-info">
                <p>–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–ø—ã—Ç–∫–∏: <span style="color: var(--highlight-color);">10 RPZD</span> –∏–ª–∏ <span id="free-cracks-count">0</span> –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫</p>
                <p id="safe-result-msg" style="font-weight: bold; color: var(--primary-color);"></p>
            </div>
            <div id="safe-container">
                <div id="safe-dial">000</div>
                <div id="safe-result-display"></div>
            </div>
            <div class="buttons">
                <button id="start-safe-cracking-btn">–í–∑–ª–æ–º–∞—Ç—å –°–µ–π—Ñ!</button>
                <button onclick="backToMain()">üîô –ù–∞–∑–∞–¥</button>
            </div>
            <div id="safe-feed">
                <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–∑–ª–æ–º–∞</h3>
                <ul id="safe-attempts-list">
                    </ul>
            </div>
        </div>
    </div>
    
    <div class="gang-screen" id="gang-screen">
        <div class="screen-content">
            <header><h1>üë• –ú–æ—è –ë–∞–Ω–¥–∞</h1></header>
            <div id="gang-container">
                <p>–ü—Ä–∏–≥–ª–∞—Å–∏ –±—Ä–∞—Ç–∏—à–µ–∫ –∏ –∫–∞—á–∞–π—Å—è –≤–º–µ—Å—Ç–µ!</p>
                <ul id="gang-members-list"></ul>
                <p id="ref-link-text">–¢–≤–æ—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</p>
                <div id="ref-link-container">
                    <input type="text" id="ref-link-input" readonly />
                    <button id="copy-ref-link-btn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <button id="share-ref-link-btn" style="margin-top: 3vw;">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π</button>
            </div>
            <div class="buttons">
                <button onclick="backToMain()">üîô –ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>
    
    <div class="vip-screen" id="vip-screen">
        <div class="screen-content">
            <header><h1>‚≠ê VIP-–®–º–æ—Ç</h1></header>
            <p>–ü–æ–ª—É—á–∏ VIP-—Å—Ç–∞—Ç—É—Å –Ω–∞ 10 –¥–Ω–µ–π!</p>
            <p>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</p>
            <ul>
                <li>–ö–ª–µ–π–º —Ä–∞–∑ –≤ 2 —á–∞—Å–∞ –≤–º–µ—Å—Ç–æ 3</li>
                <li>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã –≤ –±—É–¥—É—â–µ–º</li>
            </ul>
            <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: 10 TON</p>
            <div class="buttons">
                <button id="buy-vip-btn">–ö—É–ø–∏—Ç—å VIP</button>
                <button onclick="backToMain()">üîô –ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <div class="info-screen" id="info-screen">
        <div class="screen-content">
            <header><h1>‚ÑπÔ∏è –ß—ë –∫–∞–∫, –±—Ä–∞—Ç–∞–Ω?</h1></header>
            <p>ü™ô RPZD ‚Äî –¢–æ–∫–µ–Ω –ö—É–ª—å—Ç–∞ –†–∞—Å–ø–∏–∑–¥—è–µ–≤</p>
            <p>RPZD ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –º–æ–Ω–µ—Ç–∞. –≠—Ç–æ —Å–∏–º–≤–æ–ª —Å–≤–æ–±–æ–¥—ã, —é–º–æ—Ä–∞, —Ñ–ª–µ–∫—Å–∞ –∏ –¥–∏–∫–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞—Å—Ç–æ—è—â–∏—Ö –∫—É–ª—å—Ç–æ–≤—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π. –ë–µ–∑ KYC, –±–µ–∑ –±–∞–Ω–∫–æ–≤ –∏ —Å—Ä–∞–Ω—ã—Ö —Ä–µ–≥—É–ª—è—Ç–æ—Ä–æ–≤.</p>
            
            <h2>üìú –¢–æ–∫–µ–Ω–æ–º–∏–∫–∞ RPZD</h2>
            <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç–º–∏—Å—Å–∏—è: 690,000,000 RPZD</p>
            
            <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏—è–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ–û–ø–∏—Å–∞–Ω–∏–µ</h3>
            <ul>
                <li>üßß –†–∞–∑–¥–∞—á–∞: 50% (345M) - –ó–∞ –≤–∞–π–±, –º–µ–º—ã, —Ñ–∞—Ä–º</li>
                <li>üì£ –†–µ–∫–ª–∞–º–∞: 15% (103.5M) - –û—Ö–≤–∞—Ç—ã, –≤–∏—Ä—É—Å</li>
                <li>üí∞ –õ–∏—Å—Ç–∏–Ω–≥: 20% (138M) - –ë–∏—Ä–∂–∏ –∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å</li>
                <li>üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: 10% (69M) - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –±–æ—Ç—ã</li>
                <li>üß≥ –†–µ–∑–µ—Ä–≤: 5% (34.5M) - –§–ª–µ–∫—Å –∏–ª–∏ —è—Ö—Ç–∞ :)</li>
                <li>üéÅ –°–ø–æ–Ω—Å–æ—Ä—ã: 10% - –†–∞–Ω–Ω–∏–µ –ø–æ–º–æ—â–Ω–∏–∫–∏</li>
            </ul>

            <h2>üó∫Ô∏è –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞</h2>
            <ul>
                <li>–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å–æ–∑–¥–∞–Ω</li>
                <li>–§–∞—Ä–º-–±–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω</li>
                <li>TON-–∫–æ—à–µ–ª—å–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã</li>
                <li>–†–µ—Ñ–µ—Ä–∞–ª—å–∫–∞ –¥–∞—ë—Ç +10%</li>
                <li>–ó–∞–ø—É—â–µ–Ω–∞ —Ä–µ–∫–ª–∞–º–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è</li>
                <li>DeDust –∏ STON.fi ‚Äî —Å–∫–æ—Ä–æ</li>
                <li>–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã: OKX, Bybit, MEXC</li>
                <li>–ö–Ω–æ–ø–∫–∞ ‚Äú–ó–∞–±—Ä–∞—Ç—å –¥–æ–±—ã—á—É‚Äù ‚Äî –ø–æ—Å–ª–µ —Ä–∞–∑–¥–∞—á–∏</li>
                <li>–õ–∏—Å—Ç–∏–Ω–≥ –ø–æ—Å–ª–µ –Ω–∞–±–æ—Ä–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏</li>
            </ul>

            <h2>üí∏ –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å</h2>
            <p>–í—Å–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –æ—Ç –ø–æ–¥–ø–∏—Å–æ–∫, –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–π, —Ä–µ–∫–ª–∞–º—ã –∏–¥—É—Ç –Ω–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞. –ß–µ—Å—Ç–Ω–æ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ.</p>

            <h2>üëë –ü–æ—Å–ª–µ –ª–∏—Å—Ç–∏–Ω–≥–∞</h2>
            <p>‚úÖ–ö–æ–Ω—Ç—Ä–∞–∫—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞–≤—Å–µ–≥–¥–∞. –ù–∏–∫–∞–∫–æ–π –¥–æ–ø. —ç–º–∏—Å—Å–∏–∏. –í—Å—è –≤–ª–∞—Å—Ç—å ‚Äî —É —Ö–æ–ª–¥–µ—Ä–æ–≤. –¢–æ–∫–µ–Ω –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω. –ù–∏–∫–∞–∫–∏—Ö —Ñ–æ–∫—É—Å–æ–≤ ‚Äî —Ç–æ–ª—å–∫–æ –∫—É–ª—å—Ç.</p>

            <h2>üåÄ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è</h2>
            <p>–§–∞—Ä–º–∏ RPZD, —É—á–∞—Å—Ç–≤—É–π –≤ –º–µ–º-–∫—É–ª—å—Ç—É—Ä–µ, –±—É–¥—å —Ä–∞—Å–ø–∏–∑–¥—è–µ–º. –¢–æ–∫–µ–Ω –Ω–µ –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤. –¢–æ–∫–µ–Ω ‚Äî –¥–ª—è —Å–≤–æ–∏—Ö.</p>
            
            <div class="buttons">
                <button onclick="backToMain()">üîô –ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>
    
    <div class="admin-panel-screen" id="admin-panel-screen">
        <div class="screen-content">
            <header><h1>üõ†Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1></header>
            <div class="admin-controls">
                <div class="panel-section">
                    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º</h3>
                    <label for="admin-address-input">–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞</label>
                    <input type="text" id="admin-address-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞" />
                    <label for="admin-balance-input">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ RPZD</label>
                    <input type="number" id="admin-balance-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" />
                    <button id="set-balance-btn">–ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
                    
                    <h3 style="margin-top: 3vw;">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–∑–ª–æ–º–∞</h3>
                    <label for="admin-free-cracks-address-input">–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞</label>
                    <input type="text" id="admin-free-cracks-address-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞" />
                    <label for="admin-free-cracks-count-input">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫</label>
                    <input type="number" id="admin-free-cracks-count-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" />
                    <button id="set-free-cracks-btn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–µ—Å–ø. –ø–æ–ø—ã—Ç–∫–∏</button>
                </div>
                
                <div class="panel-section">
                    <h3>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                    <ul id="user-balances-list"></ul>
                </div>
                
                <div class="panel-section">
                    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏—Å—Å–∏—è–º–∏</h3>
                    <label for="mission-id-input">ID –º–∏—Å—Å–∏–∏</label>
                    <input type="number" id="mission-id-input" placeholder="–í–≤–µ–¥–∏—Ç–µ ID" />
                    <label for="mission-title-input">–ù–∞–∑–≤–∞–Ω–∏–µ –º–∏—Å—Å–∏–∏</label>
                    <input type="text" id="mission-title-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" />
                    <label for="mission-reward-input">–ù–∞–≥—Ä–∞–¥–∞</label>
                    <input type="number" id="mission-reward-input" placeholder="–ù–∞–≥—Ä–∞–¥–∞ RPZD" />
                    <label for="mission-target-input">–¶–µ–ª—å</label>
                    <input type="number" id="mission-target-input" placeholder="–¶–µ–ª—å" />
                    <label for="mission-type-input">–¢–∏–ø</label>
                    <input type="text" id="mission-type-input" placeholder="–¢–∏–ø (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'claim')" />
                    <label for="mission-link-input">–°—Å—ã–ª–∫–∞ –Ω–∞ –º–∏—Å—Å–∏—é</label>
                    <input type="text" id="mission-link-input" placeholder="URL –¥–ª—è –º–∏—Å—Å–∏–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
                    <button id="add-mission-btn">–î–æ–±–∞–≤–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å –º–∏—Å—Å–∏—é</button>
                    <ul id="admin-mission-list"></ul>
                </div>
                
                <div class="panel-section">
                    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–æ–º</h3>
                    <label for="banner-text-input">–¢–µ–∫—Å—Ç –±–∞–Ω–Ω–µ—Ä–∞</label>
                    <input type="text" id="banner-text-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –±–∞–Ω–Ω–µ—Ä–∞" />
                    <label for="banner-link-input">–°—Å—ã–ª–∫–∞ –±–∞–Ω–Ω–µ—Ä–∞</label>
                    <input type="text" id="banner-link-input" placeholder="–í–≤–µ–¥–∏—Ç–µ URL –¥–ª—è –±–∞–Ω–Ω–µ—Ä–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
                    <button id="save-banner-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button id="disable-banner-btn">–í—ã–∫–ª—é—á–∏—Ç—å –±–∞–Ω–Ω–µ—Ä</button>
                </div>
            </div>
            <div class="buttons">
                <button onclick="backToMain()">üîô –ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>
    
    <div id="share-modal" class="share-modal">
        <div class="share-modal-content">
            <span class="close-button" onclick="closeShareModal()">&times;</span>
            <h3>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π</h3>
            <p id="share-modal-text"></p>
            <div class="share-modal-buttons">
                <a href="#" class="telegram" id="share-telegram" target="_blank">Telegram</a>
                <a href="#" class="whatsapp" id="share-whatsapp" target="_blank">WhatsApp</a>
                <a href="#" class="vkontakte" id="share-vkontakte" target="_blank">–í–ö–æ–Ω—Ç–∞–∫—Ç–µ</a>
                <a href="#" class="facebook" id="share-facebook" target="_blank">Facebook</a>
            </div>
        </div>
    </div>

    <audio id="crack-sound" src="YOUR_CRACKING_SOUND_URL.mp3" preload="auto"></audio>
    <audio id="win-sound" src="YOUR_WIN_SOUND_URL.mp3" preload="auto"></audio>
    <audio id="fail-sound" src="YOUR_FAIL_SOUND_URL.mp3" preload="auto"></audio>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        function backToMain() {
            console.log('backToMain() called');
            document.getElementById('main-app').style.display = 'flex';
            document.getElementById('missions-screen').style.display = 'none';
            document.getElementById('safe-screen').style.display = 'none';
            document.getElementById('admin-panel-screen').style.display = 'none';
            document.getElementById('gang-screen').style.display = 'none';
            document.getElementById('vip-screen').style.display = 'none';
            document.getElementById('info-screen').style.display = 'none';
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –º–∏—Å—Å–∏–∏
        function deleteMission(id) {
            if (!walletAddress || !ADMIN_ADDRESSES.includes(walletAddress)) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
                return;
            }
            const db = getDatabase();
            const missionRef = ref(db, 'missions/' + id);
            remove(missionRef)
                .then(() => {
                    alert('–ú–∏—Å—Å–∏—è —É–¥–∞–ª–µ–Ω–∞.');
                    updateAdminPanel();
                })
                .catch((error) => {
                    console.error("Error removing mission: ", error);
                    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–∏—Å—Å–∏–∏.");
                });
        }

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–∏—Å—Å–∏–∏ –≤ —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function editMission(id) {
            const mission = missions.find(m => m.id === id);
            if (mission) {
                document.getElementById('mission-id-input').value = id;
                document.getElementById('mission-title-input').value = mission.title;
                document.getElementById('mission-reward-input').value = mission.reward;
                document.getElementById('mission-target-input').value = mission.target;
                document.getElementById('mission-type-input').value = mission.type;
                document.getElementById('mission-link-input').value = mission.link || '';
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º —à–µ—Ä–∏–Ω–≥–∞
        function openShareModal(shareText, refLink) {
            const modal = document.getElementById('share-modal');
            document.getElementById('share-modal-text').textContent = shareText;
            document.getElementById('share-telegram').href = `https://t.me/share/url?url=${encodeURIComponent(refLink)}&text=${encodeURIComponent('–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ RPZD Cult!')}`;
            document.getElementById('share-whatsapp').href = `whatsapp://send?text=${encodeURIComponent(shareText)}`;
            document.getElementById('share-vkontakte').href = `https://vk.com/share.php?url=${encodeURIComponent(refLink)}&title=${encodeURIComponent('RPZD Cult')}&comment=${encodeURIComponent('–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ RPZD Cult!')}`;
            document.getElementById('share-facebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(refLink)}`;
            modal.style.display = 'flex';
        }

        function closeShareModal() {
            document.getElementById('share-modal').style.display = 'none';
        }

    </script>
    
    <script type="module">
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
        import { getDatabase, ref, set, onValue, push, remove, update } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

        // –¢–≤–æ—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAb1uc8Totp7lIjiyOZx_OUm5zxXPHpqtU",
            authDomain: "rpzd-9b0d2.firebaseapp.com",
            databaseURL: "https://rpzd-9b0d2-default-rtdb.firebaseio.com",
            projectId: "rpzd-9b0d2",
            storageBucket: "rpzd-9b0d2.firebase.app",
            messagingSenderId: "38397028434",
            appId: "1:38397028434:web:3943be34777fd05339178b",
            measurementId: "G-T9DBQ3Y9GP"
        };
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getDatabase(app);

        // WARNING: This is a client-side application. All data stored in localStorage is insecure
        // and can be manipulated by the user. For a real-world application, all mission and balance
        // logic should be handled on a secure backend server.
        
        // --- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã ---
        const ADMIN_ADDRESSES = ["0:296d4b67108be96c1cea5481c2eb11843b0e10afbab23b7e5aae73696b233565"];
        const CLAIM_INTERVAL = 3 * 60 * 60 * 1000;
        const VIP_CLAIM_INTERVAL = 2 * 60 * 60 * 1000;
        const RPZD_AMOUNT = 69;
        const SAFE_CRACK_COST = 10; // –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏ –≤–∑–ª–æ–º–∞
        const FREE_CRACK_INTERVAL = 1 * 60 * 60 * 1000; // 1 —á–∞—Å
        const MAX_FREE_CRACKS_PER_HOUR = 3; // –ú–∞–∫—Å–∏–º—É–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤ —á–∞—Å

        // –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ "UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAM" –Ω–∞ –ê–î–†–ï–° –í–ê–®–ï–ì–û TON-–ö–û–®–ï–õ–¨–ö–ê –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã –∑–∞ VIP.
        const VIP_WALLET_ADDRESS = "UQApbUtnEIvpbBzqVIHC6xGEOw4Qr7qyO35arnNpayM1ZWJa"; 
        const VIP_COST_TON = 10; // –°—Ç–æ–∏–º–æ—Å—Ç—å VIP –≤ TON
        const VIP_DURATION_DAYS = 10; // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å VIP –≤ –¥–Ω—è—Ö

        // –ù–æ–≤—ã–µ –ø—Ä–∏–∑—ã –¥–ª—è "–í–∑–ª–æ–º–∞ –°–µ–π—Ñ–∞" —Å —é–º–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
        const SAFE_CRACK_PRIZES = [
            { id: 0, type: 'rpzd', value: 100, text: "ü§Ø –û–ì–û! –°–µ–π—Ñ —Ä–∞–∑–æ—Ä–≤–∞–ª–æ –≤ –∫–ª–æ—á—å—è! –≠–¢–û –î–ñ–ï–ö–ü–û–¢!", color: "#FF00FF", weight: 0.5 }, // –î–∂–µ–∫–ø–æ—Ç
            { id: 1, type: 'rpzd', value: 70, text: "üéâ –î–≤–µ—Ä—å —Å–µ–π—Ñ–∞ —Ä–∞—Å–ø–∞—Ö–Ω—É–ª–∞—Å—å! 70 RPZD —Ç–≤–æ–∏!", color: "#00FFFF", weight: 1 },
            { id: 2, type: 'rpzd', value: 55, text: "–¢—ã —ç—Ç–æ —Å–¥–µ–ª–∞–ª! –°–µ–π—Ñ –æ–ø—É—Å—Ç–æ—à–µ–Ω: +55 RPZD", color: "#00FF00", weight: 2 },
            { id: 3, type: 'rpzd', value: 50, text: "–°–µ–π—Ñ –ø–æ–¥–¥–∞–ª—Å—è! –ú–æ–∏ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è: +50 RPZD", color: "#FFC107", weight: 3 },
            { id: 4, type: 'rpzd', value: 30, text: "–û—Ç–ª–∏—á–Ω–æ! +30 RPZD –∏–∑ —Å–µ–π—Ñ–∞!", color: "#2196F3", weight: 5 },
            { id: 5, type: 'rpzd', value: 15, text: "–ú–µ–ª–æ—á—å, –Ω–æ –ø—Ä–∏—è—Ç–Ω–æ: +15 RPZD", color: "#9C27B0", weight: 7 },
            { id: 6, type: 'rpzd', value: 5, text: " RPZD-–¥–∞—á–∞! +5 RPZD", color: "#4CAF50", weight: 10 },
            { id: 7, type: 'free_crack', value: 1, text: "–ù–∞—à–µ–ª –æ—Ç–º—ã—á–∫—É! +1 –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ü–æ–ø—ã—Ç–∫–∞", color: "#FFFF00", weight: 11 },
            { id: 8, type: 'loss', value: 0, text: "–≠—Ö, –Ω–µ –≤ —ç—Ç–æ—Ç —Ä–∞–∑! –°–µ–π—Ñ –æ–∫–∞–∑–∞–ª—Å—è –∫—Ä–µ–ø–∫–∏–º –æ—Ä–µ—à–∫–æ–º, –Ω–æ –º—ã –µ–≥–æ –Ω–∞–µ–±–µ–º –≤ –¥—Ä—É–≥–æ–π —Ä–∞–∑!", color: "#E0E0E0", weight: 4 },
            { id: 9, type: 'loss', value: -10, text: "–°–∏—Å—Ç–µ–º–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞—Å—å. –ù—É –Ω–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ, –≤ –¥—Ä—É–≥–æ–π —Ä–∞–∑ –º—ã –µ–≥–æ –Ω–∞–µ–±–µ–º! (-10 RPZD)", color: "#F44336", weight: 8 },
        ];

        const quotes = [
            "–§–ª–µ–∫—Å ‚Äî —ç—Ç–æ –Ω–µ –≤—ã–±–æ—Ä, –∞ –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏.",
            "–ù–∞—Å—Ç–æ—è—â–∏–π —Ä–∞—Å–ø–∏–∑–¥—è–π –Ω–µ –∂–¥—ë—Ç, –æ–Ω –±–µ—Ä—ë—Ç.",
            "–ö—Ç–æ –¥–µ—Ä–∂–∏—Ç RPZD ‚Äî —Ç–æ—Ç —Ä—É–ª–∏—Ç.",
            "–ù–∞—Å—Ç–æ—è—â–∏–π —Ä–∞—Å–ø–∏–∑–¥—è–π –≤—Å–µ–≥–¥–∞ –≤ –ø–ª—é—Å–µ.",
            "–ï—Å–ª–∏ –∂–∏–∑–Ω—å –±—å—ë—Ç ‚Äî –±–µ–π –≤ –æ—Ç–≤–µ—Ç —Ç–æ–∫–µ–Ω–æ–º.",
            "–ü–æ–∫–∞ –¥—Ä—É–≥–∏–µ –¥—É–º–∞—é—Ç ‚Äî —Ä–∞—Å–ø–∏–∑–¥—è–∏ —Ñ–ª–µ–∫—Å—è—Ç."
        ];
        const userLevels = [
            { threshold: 0, text: '–ù–∞—á–∏–Ω–∞—é—â–∏–π —Ä–∞—Å–ø–∏–∑–¥—è–π', avatar: 'üê£' },
            { threshold: 1000, text: '–û–ø—ã—Ç–Ω—ã–π —Ä–∞—Å–ø–∏–∑–¥—è–π', avatar: 'üòé' },
            { threshold: 5000, text: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Ä–∞—Å–ø–∏–∑–¥—è–π', avatar: 'üßë‚Äçüíª' },
            { threshold: 10000, text: '–ú–∞—Å—Ç–µ—Ä —Ä–∞—Å–ø–∏–∑–¥—è–π—Å—Ç–≤–∞', avatar: 'üëë' },
            { threshold: 50000, text: '–õ–µ–≥–µ–Ω–¥–∞ RPZD', avatar: 'üöÄ' },
        ];

        // TonConnectUI setup
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://rpzd-cult.vercel.app/tonconnect-manifest.json',
            buttonRootId: 'connect-wallet-btn'
        });

        let walletAddress = null;
        let missions = [];
        let bannerData = null;
        let isCracking = false;
        
        let balances = {};
        let lastClaims = {};
        let userProgress = {};
        let userIsVip = false;
        let userFreeCracks = 0;
        let lastFreeCrackReset = 0;
        
        // --- Firebase Functions ---
        function loadMissions() {
            const missionsRef = ref(db, 'missions');
            onValue(missionsRef, (snapshot) => {
                const data = snapshot.val();
                missions = data ? Object.values(data) : [];
                missions.sort((a, b) => a.id - b.id);
                updateMissionsDisplay();
                updateAdminPanel();
            });
        }
        
        function loadBanner() {
            const bannerRef = ref(db, 'banner');
            onValue(bannerRef, (snapshot) => {
                bannerData = snapshot.val();
                updateUI();
            });
        }
        
        function loadSafeFeed() {
            const safeFeedRef = ref(db, 'safe_attempts');
            onValue(safeFeedRef, (snapshot) => {
                const feed = document.getElementById('safe-attempts-list');
                feed.innerHTML = '';
                const data = snapshot.val();
                if (data) {
                    const latestAttempts = Object.values(data).slice(-5).reverse();
                    latestAttempts.forEach(attempt => {
                        const li = document.createElement('li');
                        const shortAddress = attempt.walletAddress.substring(0, 6) + '...' + attempt.walletAddress.substring(attempt.walletAddress.length - 4);
                        const resultClass = attempt.type === 'loss' ? 'fail-text' : 'win-text';
                        li.innerHTML = `
                            <span>${shortAddress}</span>
                            <span class="${resultClass}">${attempt.prizeText}</span>
                        `;
                        feed.appendChild(li);
                    });
                }
            });
        }

        function addOrUpdateMission(id, title, reward, target, type, link) {
            const missionData = {
                id: Number(id),
                title: title,
                reward: Number(reward),
                target: Number(target),
                type: type,
                link: link || ''
            };
            set(ref(db, 'missions/' + id), missionData)
                .then(() => {
                    alert('–ú–∏—Å—Å–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞/–∏–∑–º–µ–Ω–µ–Ω–∞.');
                    clearMissionForm();
                })
                .catch((error) => {
                    console.error("Error writing mission: ", error);
                    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/–∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∏—Å—Å–∏–∏.");
                });
        }
        
        function updateUser(address, data) {
            update(ref(db, 'users/' + address), data)
                .catch((error) => {
                    console.error("Error updating user data: ", error);
                });
        }
        
        function completeMission(missionId) {
            if (!walletAddress) {
                alert('–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É.');
                return;
            }

            const mission = missions.find(m => m.id === missionId);
            if (!mission) {
                alert('–¢–∞–∫–æ–π –º–∏—Å—Å–∏–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.');
                return;
            }

            onValue(ref(db, `users/${walletAddress}/completedMissions/${missionId}`), (snapshot) => {
                if (snapshot.exists()) {
                    alert('–í—ã —É–∂–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ.');
                    return;
                }

                let isCompleted = false;
                if (mission.type === 'telegram_join') {
                    isCompleted = true; // –î–ª—è —Ç–µ–ª–µ–≥—Ä–∞–º-–º–∏—Å—Å–∏–π –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –≤–Ω–µ—à–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–∂–µ –ø—Ä–æ–∏–∑–æ—à–ª–∞
                } else if (mission.type === 'claim_count') {
                    onValue(ref(db, `users/${walletAddress}/claimCount`), (claimSnapshot) => {
                        const claimCount = claimSnapshot.val() || 0;
                        if (claimCount >= mission.target) {
                            isCompleted = true;
                        }
                    }, { onlyOnce: true });
                }

                if (isCompleted) {
                    const userRef = ref(db, `users/${walletAddress}`);
                    onValue(userRef, (userSnapshot) => {
                        const userData = userSnapshot.val() || { balance: 0, completedMissions: {} };
                        const newBalance = (userData.balance || 0) + mission.reward;

                        const updates = {};
                        updates[`balance`] = newBalance;
                        updates[`completedMissions/${missionId}`] = true;

                        update(userRef, updates)
                            .then(() => {
                                alert(`–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! –í—ã –ø–æ–ª—É—á–∏–ª–∏ ${mission.reward} RPZD.`);
                                updateUI();
                            })
                            .catch(error => console.error("Error rewarding mission: ", error));
                    }, { onlyOnce: true });
                } else {
                    alert('–ó–∞–¥–∞–Ω–∏–µ –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ —É—Å–ª–æ–≤–∏—è.');
                }
            }, { onlyOnce: true });
        }
        
        // --- End of Firebase Functions ---

        function updateMissionsDisplay() {
            const container = document.getElementById('missions-container');
            container.innerHTML = '';
            
            missions.forEach(mission => {
                const missionEl = document.createElement('div');
                missionEl.className = 'mission-item';
                missionEl.innerHTML = `
                    <p class="mission-title">${mission.title}</p>
                    <p>–ù–∞–≥—Ä–∞–¥–∞: <span class="mission-reward">${mission.reward} RPZD</span></p>
                    ${mission.link ? `<a href="${mission.link}" target="_blank" class="mission-link">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–¥–∞–Ω–∏—é</a>` : ''}
                    <button class="mission-button" onclick="completeMission(${mission.id})">–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>
                `;
                container.appendChild(missionEl);
            });
        }
        
        function updateAdminPanel() {
            if (!walletAddress || !ADMIN_ADDRESSES.includes(walletAddress)) return;
            
            const bannerRef = ref(db, 'banner');
            onValue(bannerRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('banner-text-input').value = data.text || '';
                    document.getElementById('banner-link-input').value = data.link || '';
                } else {
                    document.getElementById('banner-text-input').value = '';
                    document.getElementById('banner-link-input').value = '';
                }
            }, { onlyOnce: true });

            const adminMissionList = document.getElementById('admin-mission-list');
            adminMissionList.innerHTML = '';
            missions.forEach(m => {
                const li = document.createElement('li');
                li.innerHTML = `
                    ID: ${m.id} | –ù–∞–∑–≤–∞–Ω–∏–µ: ${m.title} | –ù–∞–≥—Ä–∞–¥–∞: ${m.reward} RPZD
                    <button onclick="editMission(${m.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button onclick="deleteMission(${m.id})">–£–¥–∞–ª–∏—Ç—å</button>
                `;
                adminMissionList.appendChild(li);
            });

            const userBalancesList = document.getElementById('user-balances-list');
            userBalancesList.innerHTML = '';
            onValue(ref(db, 'users'), (snapshot) => {
                const users = snapshot.val();
                if (users) {
                    Object.keys(users).forEach(address => {
                        const user = users[address];
                        const li = document.createElement('li');
                        li.textContent = `Address: ${address}, Balance: ${user.balance || 0} RPZD, Free Cracks: ${user.freeCracks || 0}`;
                        userBalancesList.appendChild(li);
                    });
                }
            }, { onlyOnce: true });
        }

        document.getElementById('set-balance-btn').addEventListener('click', () => {
            if (!walletAddress || !ADMIN_ADDRESSES.includes(walletAddress)) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
                return;
            }
            const address = document.getElementById('admin-address-input').value;
            const balance = parseInt(document.getElementById('admin-balance-input').value);
            if (address && !isNaN(balance)) {
                update(ref(db, `users/${address}`), { balance: balance })
                    .then(() => {
                        alert('–ë–∞–ª–∞–Ω—Å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω.');
                        updateAdminPanel();
                    })
                    .catch(error => console.error("Error setting balance: ", error));
            } else {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –∏ —á–∏—Å–ª–æ–≤–æ–π –±–∞–ª–∞–Ω—Å.');
            }
        });

        document.getElementById('set-free-cracks-btn').addEventListener('click', () => {
            if (!walletAddress || !ADMIN_ADDRESSES.includes(walletAddress)) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
                return;
            }
            const address = document.getElementById('admin-free-cracks-address-input').value;
            const count = parseInt(document.getElementById('admin-free-cracks-count-input').value);
            if (address && !isNaN(count)) {
                update(ref(db, `users/${address}`), { freeCracks: count })
                    .then(() => {
                        alert('–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.');
                        updateAdminPanel();
                        loadData();
                    })
                    .catch(error => console.error("Error setting free cracks: ", error));
            } else {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –∏ —á–∏—Å–ª–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫.');
            }
        });


        document.getElementById('add-mission-btn').addEventListener('click', () => {
            const id = document.getElementById('mission-id-input').value;
            const title = document.getElementById('mission-title-input').value;
            const reward = document.getElementById('mission-reward-input').value;
            const target = document.getElementById('mission-target-input').value;
            const type = document.getElementById('mission-type-input').value;
            const link = document.getElementById('mission-link-input').value;

            if (id && title && reward && target && type) {
                addOrUpdateMission(id, title, reward, target, type, link);
            } else {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –º–∏—Å—Å–∏–∏, –∫—Ä–æ–º–µ —Å—Å—ã–ª–∫–∏.');
            }
        });
        
        document.getElementById('save-banner-btn').addEventListener('click', () => {
            if (!walletAddress || !ADMIN_ADDRESSES.includes(walletAddress)) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
                return;
            }
            const text = document.getElementById('banner-text-input').value;
            const link = document.getElementById('banner-link-input').value;
            const bannerRef = ref(db, 'banner');

            if (text) {
                set(bannerRef, { text, link })
                    .then(() => {
                        alert('–ë–∞–Ω–Ω–µ—Ä —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω.');
                    })
                    .catch((error) => {
                        console.error("Error writing banner: ", error);
                        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –±–∞–Ω–Ω–µ—Ä–∞.");
                    });
            } else {
                alert('–¢–µ–∫—Å—Ç –±–∞–Ω–Ω–µ—Ä–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.');
            }
        });
        
        document.getElementById('disable-banner-btn').addEventListener('click', () => {
            if (!walletAddress || !ADMIN_ADDRESSES.includes(walletAddress)) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
                return;
            }
            const bannerRef = ref(db, 'banner');
            remove(bannerRef)
                .then(() => {
                    alert('–ë–∞–Ω–Ω–µ—Ä –≤—ã–∫–ª—é—á–µ–Ω.');
                    document.getElementById('banner-text-input').value = '';
                    document.getElementById('banner-link-input').value = '';
                })
                .catch((error) => {
                    console.error("Error removing banner: ", error);
                    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ –±–∞–Ω–Ω–µ—Ä–∞.");
                });
        });

        function clearMissionForm() {
            document.getElementById('mission-id-input').value = '';
            document.getElementById('mission-title-input').value = '';
            document.getElementById('mission-reward-input').value = '';
            document.getElementById('mission-target-input').value = '';
            document.getElementById('mission-type-input').value = '';
            document.getElementById('mission-link-input').value = '';
        }

        window.completeMission = completeMission;
        
        function loadData() {
            if (!walletAddress) return;
            const userRef = ref(db, 'users/' + walletAddress);
            onValue(userRef, (snapshot) => {
                const userData = snapshot.val() || { balance: 0, lastClaim: 0, isVip: false, vipUntil: 0, freeCracks: 0, lastFreeCrackReset: 0 };
                balances[walletAddress] = userData.balance || 0;
                lastClaims[walletAddress] = userData.lastClaim || 0;
                userProgress[walletAddress] = userData.progress || {};
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∏—Å—Ç–µ—á–µ–Ω–∏–µ VIP-—Å—Ç–∞—Ç—É—Å–∞
                if (userData.isVip && userData.vipUntil && userData.vipUntil < Date.now()) {
                    console.log('VIP —Å—Ç–∞—Ç—É—Å –∏—Å—Ç–µ–∫. –û–±–Ω–æ–≤–ª—è–µ–º...');
                    userIsVip = false;
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ Firebase
                    update(userRef, { isVip: false });
                } else {
                    userIsVip = userData.isVip || false;
                }

                userFreeCracks = userData.freeCracks || 0;
                lastFreeCrackReset = userData.lastFreeCrackReset || 0;
                
                // –õ–æ–≥–∏–∫–∞ —Å–±—Ä–æ—Å–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∫–∞–∂–¥—ã–π —á–∞—Å
                const now = Date.now();
                if (now - lastFreeCrackReset >= FREE_CRACK_INTERVAL) {
                    if (userFreeCracks < MAX_FREE_CRACKS_PER_HOUR) {
                        const newFreeCracks = MAX_FREE_CRACKS_PER_HOUR;
                        update(userRef, { freeCracks: newFreeCracks, lastFreeCrackReset: now })
                            .then(() => {
                                userFreeCracks = newFreeCracks;
                                lastFreeCrackReset = now;
                                updateUI();
                            })
                            .catch(error => console.error("Error resetting free cracks: ", error));
                    } else {
                        // –ï—Å–ª–∏ —É–∂–µ MAX, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏–º –≤—Ä–µ–º—è —Å–±—Ä–æ—Å–∞, —á—Ç–æ–±—ã –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å —á–∞—â–µ
                        update(userRef, { lastFreeCrackReset: now })
                             .then(() => {
                                lastFreeCrackReset = now;
                                updateUI();
                            })
                            .catch(error => console.error("Error updating lastFreeCrackReset: ", error));
                    }
                }

                updateUI();
                updateRefLink();
            });
        }
        
        function updateRefLink() {
            const refLinkInput = document.getElementById('ref-link-input');
            if (walletAddress) {
                const refLink = `${window.location.origin}${window.location.pathname}?ref=${walletAddress}`;
                refLinkInput.value = refLink;
            } else {
                refLinkInput.value = '–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏';
            }
        }
        
        // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø shareRefLink
        function shareRefLink() {
            if (!walletAddress) {
                alert('–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π.');
                tonConnectUI.openModal();
                return;
            }
            const refLink = `${window.location.origin}${window.location.pathname}?ref=${walletAddress}`;
            const shareText = `–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –∫—É–ª—å—Ç—É RPZD –ø–æ –º–æ–µ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ! ${refLink}`;

            if (navigator.share) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Ç–∏–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —à–µ—Ä–∏–Ω–≥–∞, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞
                navigator.share({
                    title: 'RPZD Cult',
                    text: shareText,
                    url: refLink
                }).then(() => {
                    console.log('–°–ø–∞—Å–∏–±–æ –∑–∞ —à–µ—Ä–∏–Ω–≥!');
                }).catch((error) => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ navigator.share:', error);
                    // –ï—Å–ª–∏ –Ω–∞—Ç–∏–≤–Ω—ã–π —à–µ—Ä–∏–Ω–≥ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –∏–ª–∏ –æ—Ç–º–µ–Ω–µ–Ω, –ø–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    openShareModal(shareText, refLink);
                });
            } else {
                // –ï—Å–ª–∏ navigator.share –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                openShareModal(shareText, refLink);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å"
        document.getElementById('copy-ref-link-btn').addEventListener('click', () => {
            const refLinkInput = document.getElementById('ref-link-input');
            refLinkInput.select();
            refLinkInput.setSelectionRange(0, 99999); // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            document.execCommand('copy');
            alert('–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
        });


        function updateUI() {
            const balanceSpan = document.getElementById('rpzd-balance');
            const levelSpan = document.getElementById('user-level-text');
            const avatarSpan = document.getElementById('user-avatar');
            const walletInfoSpan = document.getElementById('wallet-info');
            const adminBtn = document.getElementById('admin-btn');
            const freeCracksSpan = document.getElementById('free-cracks-count');
            
            if (walletAddress) {
                balanceSpan.textContent = (balances[walletAddress] || 0).toLocaleString();
                const userBalance = balances[walletAddress] || 0;
                const userLevel = userLevels.find(level => userBalance >= level.threshold) || userLevels[0];
                levelSpan.textContent = userIsVip ? `‚≠ê ${userLevel.text}` : userLevel.text;
                avatarSpan.textContent = userLevel.avatar;

                const shortAddress = walletAddress.substring(0, 6) + '...' + walletAddress.substring(walletAddress.length - 4);
                walletInfoSpan.textContent = shortAddress;
                walletInfoSpan.title = walletAddress;
                
                freeCracksSpan.textContent = userFreeCracks;

                if (ADMIN_ADDRESSES.includes(walletAddress)) {
                    adminBtn.style.display = 'block';
                    updateAdminPanel();
                } else {
                    adminBtn.style.display = 'none';
                }
            } else {
                balanceSpan.textContent = '0';
                levelSpan.textContent = '–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫';
                avatarSpan.textContent = 'ü§∑';
                walletInfoSpan.textContent = '–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫';
                walletInfoSpan.title = '';
                adminBtn.style.display = 'none';
                freeCracksSpan.textContent = '0';
            }
            
            const bannerEl = document.getElementById('idea-banner');
            if (bannerData && bannerData.text) {
                bannerEl.textContent = bannerData.text;
                bannerEl.style.display = 'block';
                if (bannerData.link) {
                    bannerEl.onclick = () => window.open(bannerData.link, '_blank');
                    bannerEl.style.cursor = 'pointer';
                } else {
                    bannerEl.onclick = () => window.open('https://t.me/WMagic_RUS?text=%D0%A3%20%D0%9C%D0%B5%D0%BD%D1%8F%20%D1%80%D0%BE%D0%B4%D0%B8%D0%BB%D0%B0%D1%81%D1%8C%20%D0%9C%D1%8B%D1%81%D0%BB%D1%8C!', '_blank');
                    bannerEl.style.cursor = 'pointer';
                }
            } else {
                bannerEl.style.display = 'none';
            }
        }
        
        // Wallet connection logic
        tonConnectUI.onStatusChange(wallet => {
            if (wallet) {
                walletAddress = wallet.account.address;
                updateUI();
                loadData();
                checkClaimTimer();
                updateMissionsDisplay();
                updateRefLink();
            } else {
                walletAddress = null;
                updateUI();
                updateRefLink();
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadMissions();
            loadBanner();
            loadSafeFeed();
            if (tonConnectUI.connected) {
                walletAddress = tonConnectUI.wallet.account.address;
                loadData();
                checkClaimTimer();
                updateRefLink();
            } else {
                updateUI();
                updateRefLink();
            }

            const mainApp = document.getElementById('main-app');
            const missionsScreen = document.getElementById('missions-screen');
            const safeScreen = document.getElementById('safe-screen');
            const gangScreen = document.getElementById('gang-screen');
            const vipScreen = document.getElementById('vip-screen');
            const infoScreen = document.getElementById('info-screen');
            const adminPanelScreen = document.getElementById('admin-panel-screen');

            const allScreens = [mainApp, missionsScreen, safeScreen, gangScreen, vipScreen, infoScreen, adminPanelScreen];

            function showScreen(screenToShow) {
                allScreens.forEach(screen => {
                    screen.style.display = (screen === screenToShow) ? 'flex' : 'none';
                });
            }

            document.getElementById('mission-btn').addEventListener('click', () => showScreen(missionsScreen));
            document.getElementById('safe-cracking-btn').addEventListener('click', () => {
                showScreen(safeScreen);
                document.getElementById('safe-dial').textContent = '000';
                document.getElementById('safe-result-display').textContent = '';
                document.getElementById('safe-result-display').style.opacity = '0';
            });
            document.getElementById('gang-btn').addEventListener('click', () => showScreen(gangScreen));
            // –£–î–ê–õ–ï–ù–û: document.getElementById('ref-btn').addEventListener('click', () => showScreen(gangScreen));
            document.getElementById('vip-btn').addEventListener('click', () => showScreen(vipScreen));
            document.getElementById('info-btn').addEventListener('click', () => showScreen(infoScreen));
            document.getElementById('admin-btn').addEventListener('click', () => {
                if (ADMIN_ADDRESSES.includes(walletAddress)) {
                    showScreen(adminPanelScreen);
                    updateAdminPanel();
                }
            });
            
            // –ù–û–í–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø –ö–ù–û–ü–ö–ò –ü–û–ö–£–ü–ö–ò VIP
            document.getElementById('buy-vip-btn').addEventListener('click', handleVipPurchase);

            // –ù–û–í–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø –ö–ù–û–ü–ö–ò "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π"
            document.getElementById('share-ref-link-btn').addEventListener('click', shareRefLink);
        });

        document.getElementById('claim-btn').addEventListener('click', () => {
            if (!walletAddress) {
                alert('–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫, —á—Ç–æ–±—ã –∫–ª–µ–π–º–∏—Ç—å RPZD!');
                return;
            }

            const now = Date.now();
            const lastClaimTime = lastClaims[walletAddress] || 0;
            const interval = userIsVip ? VIP_CLAIM_INTERVAL : CLAIM_INTERVAL;

            if (now - lastClaimTime >= interval) {
                const currentBalance = balances[walletAddress] || 0;
                const newBalance = currentBalance + RPZD_AMOUNT;
                
                const updates = {};
                updates['balance'] = newBalance;
                updates['lastClaim'] = now;
                updates['claimCount'] = (userProgress[walletAddress].claimCount || 0) + 1;

                update(ref(db, `users/${walletAddress}`), updates)
                    .then(() => {
                        lastClaims[walletAddress] = now;
                        balances[walletAddress] = newBalance;
                        userProgress[walletAddress].claimCount = updates['claimCount'];
                        updateUI();
                        checkClaimTimer();
                    })
                    .catch(error => console.error("Error claiming RPZD: ", error));
            } else {
                alert('–ü–æ–¥–æ–∂–¥–∏ –Ω–µ–º–Ω–æ–≥–æ, –±—Ä–æ. –ï—â–µ –Ω–µ –≤—Ä–µ–º—è –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–ª–µ–π–º–∞!');
            }
        });
        
        function checkClaimTimer() {
            const claimTimerText = document.getElementById('claim-timer-text');
            if (!walletAddress) {
                claimTimerText.textContent = '';
                return;
            }

            const lastClaimTime = lastClaims[walletAddress] || 0;
            const interval = userIsVip ? VIP_CLAIM_INTERVAL : CLAIM_INTERVAL;
            const now = Date.now();
            const timeLeft = interval - (now - lastClaimTime);

            if (timeLeft <= 0) {
                claimTimerText.textContent = '–ö–õ–ï–ô–ú –î–û–°–¢–£–ü–ï–ù!';
                document.getElementById('claim-btn').style.opacity = '1';
                document.getElementById('claim-btn').style.pointerEvents = 'auto';
            } else {
                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                claimTimerText.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('claim-btn').style.opacity = '0.5';
                document.getElementById('claim-btn').style.pointerEvents = 'none';
            }
            setTimeout(checkClaimTimer, 1000);
        }
        
        window.completeMission = completeMission;
        window.shareRefLink = shareRefLink; // –î–µ–ª–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ–π –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
        window.openShareModal = openShareModal; // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
        window.closeShareModal = closeShareModal; // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
        
        // --- Safe Cracking Logic (Animated Dial) ---
        const safeDial = document.getElementById('safe-dial');
        const startSafeCrackingBtn = document.getElementById('start-safe-cracking-btn');
        const safeResultDisplay = document.getElementById('safe-result-display');
        const safeResultMsg = document.getElementById('safe-result-msg');

        // Audio elements
        const crackSound = document.getElementById('crack-sound');
        const winSound = document.getElementById('win-sound');
        const failSound = document.getElementById('fail-sound');

        let dialAnimationInterval;
        let crackAnimationFrameId;
        
        // Function to choose a prize based on weights
        function selectPrize() {
            let totalWeight = SAFE_CRACK_PRIZES.reduce((sum, prize) => sum + prize.weight, 0);
            let random = Math.random() * totalWeight;

            for (let i = 0; i < SAFE_CRACK_PRIZES.length; i++) {
                random -= SAFE_CRACK_PRIZES[i].weight;
                if (random < 0) {
                    return SAFE_CRACK_PRIZES[i];
                }
            }
            return SAFE_CRACK_PRIZES[SAFE_CRACK_PRIZES.length - 1]; // Fallback
        }

        function animateSafeDial() {
            let count = 0;
            safeDial.textContent = '000';
            dialAnimationInterval = setInterval(() => {
                count = (count + Math.floor(Math.random() * 10) + 1) % 1000;
                safeDial.textContent = String(count).padStart(3, '0');
            }, 50);
        }

        function stopSafeDialAnimation() {
            clearInterval(dialAnimationInterval);
        }

        async function startSafeCracking() {
            if (!walletAddress) {
                alert('–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫, —á—Ç–æ–±—ã –≤–∑–ª–æ–º–∞—Ç—å —Å–µ–π—Ñ!');
                return;
            }
            if (isCracking) return;
            
            const hasFreeCrack = userFreeCracks > 0;
            const currentBalance = balances[walletAddress] || 0;
            
            if (!hasFreeCrack && currentBalance < SAFE_CRACK_COST) {
                alert(`–£ —Ç–µ–±—è –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç RPZD –¥–ª—è –≤–∑–ª–æ–º–∞ —Å–µ–π—Ñ–∞. –ù—É–∂–Ω–æ ${SAFE_CRACK_COST} RPZD.`);
                return;
            }
            
            isCracking = true;
            startSafeCrackingBtn.disabled = true;
            safeResultDisplay.textContent = '–í–∑–ª–æ–º...';
            safeResultDisplay.style.color = getComputedStyle(document.documentElement).getPropertyValue('--primary-color').trim();
            safeResultDisplay.style.opacity = '1';
            safeResultMsg.textContent = ''; // Clear previous message

            // Play crack sound
            crackSound.play();

            // Start dial animation
            animateSafeDial();

            const crackDuration = 3000; // 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(async () => {
                stopSafeDialAnimation();
                crackSound.pause(); // Stop crack sound
                crackSound.currentTime = 0; // Reset sound

                const selectedPrize = selectPrize();
                let newBalance = currentBalance;
                let newFreeCracks = userFreeCracks;

                if (hasFreeCrack) {
                    newFreeCracks--;
                } else {
                    newBalance -= SAFE_CRACK_COST;
                }
                
                let prizeText = selectedPrize.text;
                let textColor = selectedPrize.color;

                if (selectedPrize.type === 'rpzd') {
                    newBalance += selectedPrize.value;
                    winSound.play(); // Play win sound
                } else if (selectedPrize.type === 'free_crack') {
                    newFreeCracks += selectedPrize.value;
                    winSound.play(); // Play win sound
                } else if (selectedPrize.type === 'loss') {
                    if (selectedPrize.value < 0) {
                        newBalance += selectedPrize.value;
                    }
                    failSound.play(); // Play fail sound
                }

                safeDial.textContent = 'üîí'; // Show lock or a symbol when done
                safeResultDisplay.textContent = selectedPrize.value > 0 ? `+${selectedPrize.value} RPZD` : (selectedPrize.value < 0 ? `${selectedPrize.value} RPZD` : '–ù–∏—á–µ–≥–æ');
                safeResultDisplay.style.color = textColor;
                safeResultMsg.textContent = prizeText;
                
                const updates = {};
                updates['balance'] = newBalance;
                updates['freeCracks'] = newFreeCracks;
                updates['lastFreeCrackReset'] = lastFreeCrackReset;

                try {
                    await update(ref(db, `users/${walletAddress}`), updates);
                    balances[walletAddress] = newBalance;
                    userFreeCracks = newFreeCracks;
                    updateUI();
                    const safeAttemptsRef = ref(db, 'safe_attempts');
                    const newAttemptRef = push(safeAttemptsRef);
                    await set(newAttemptRef, {
                        walletAddress: walletAddress,
                        prizeText: prizeText,
                        type: selectedPrize.type,
                        timestamp: Date.now()
                    });
                    loadSafeFeed();
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤–∑–ª–æ–º–∞ —Å–µ–π—Ñ–∞: ", error);
                } finally {
                    isCracking = false;
                    startSafeCrackingBtn.disabled = false;
                    setTimeout(() => {
                        safeResultDisplay.textContent = '';
                        safeResultDisplay.style.opacity = '0';
                    }, 3000); // –°–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                }
            }, crackDuration);
        }

        startSafeCrackingBtn.addEventListener('click', startSafeCracking);
        
        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–û–ö–£–ü–ö–ò VIP
        async function handleVipPurchase() {
            if (!walletAddress) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ VIP.');
                tonConnectUI.openModal();
                return;
            }

            if (VIP_WALLET_ADDRESS === "UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAM") { // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –∞–¥—Ä–µ—Å
                alert("–û—à–∏–±–∫–∞: –ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –¥–ª—è VIP-–æ–ø–ª–∞—Ç—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.");
                return;
            }

            const transaction = {
                validUntil: Math.floor(Date.now() / 1000) + 600, // 10 –º–∏–Ω—É—Ç
                messages: [
                    {
                        address: VIP_WALLET_ADDRESS,
                        amount: (VIP_COST_TON * 10**9).toString(), // –≤ –Ω–∞–Ω–æ—Ç–æ–Ω–∞—Ö
                    }
                ]
            };

            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                await tonConnectUI.sendTransaction(transaction);
                
                // –í —Å–ª—É—á–∞–µ —É—Å–ø–µ—Ö–∞, –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firebase
                const vipUntil = Date.now() + (VIP_DURATION_DAYS * 24 * 60 * 60 * 1000);
                const userRef = ref(db, `users/${walletAddress}`);
                
                await update(userRef, {
                    isVip: true,
                    vipUntil: vipUntil
                });

                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ UI
                userIsVip = true;
                
                alert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø—Ä–∏–æ–±—Ä–µ–ª–∏ VIP-—Å—Ç–∞—Ç—É—Å!');
                updateUI();
                backToMain();

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ VIP:', error);
                alert('–ü–æ–∫—É–ø–∫–∞ VIP –±—ã–ª–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.');
            }
        }
    </script>
</body>
</html>